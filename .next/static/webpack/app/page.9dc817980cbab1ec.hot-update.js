"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("app/page",{

/***/ "(app-pages-browser)/./lib/supabase-user-service.ts":
/*!**************************************!*\
  !*** ./lib/supabase-user-service.ts ***!
  \**************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SupabaseUserService: () => (/* binding */ SupabaseUserService)\n/* harmony export */ });\n/* harmony import */ var _supabase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./supabase */ \"(app-pages-browser)/./lib/supabase.ts\");\n\nclass SupabaseUserService {\n    static isSupabaseConfigured() {\n        return _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase !== null;\n    }\n    static async getCurrentUser() {\n        if (!this.isSupabaseConfigured()) {\n            return null;\n        }\n        try {\n            const { data: { user }, error: authError } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.auth.getUser();\n            /**\n       * Supabase returns an `Auth session missing!` error\n       * when the user is not signed-in. This isn’t a real\n       * failure — it simply means there’s no active session.\n       */ if (authError && authError.message !== \"Auth session missing!\") {\n                console.error(\"Auth error:\", authError);\n            }\n            if (!user) return null;\n            if (!this.currentUser || this.currentUser.id !== user.id) {\n                const { data: userData, error: dbError } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"users\").select(\"*\").eq(\"id\", user.id).single();\n                if (dbError) {\n                    console.error(\"Database error:\", dbError);\n                    return null;\n                }\n                if (userData) {\n                    this.currentUser = {\n                        id: userData.id,\n                        name: userData.name,\n                        email: userData.email,\n                        createdAt: new Date(userData.created_at),\n                        preferences: userData.preferences || {\n                            darkMode: true,\n                            ttsEnabled: true,\n                            notifications: true\n                        }\n                    };\n                }\n            }\n            return this.currentUser;\n        } catch (error) {\n            console.error(\"Error getting current user:\", error);\n            return null;\n        }\n    }\n    static async signUp(name, email, password) {\n        if (!this.isSupabaseConfigured()) {\n            return {\n                success: false,\n                error: \"Database not configured. Please set up Supabase credentials.\"\n            };\n        }\n        try {\n            const { data, error } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.auth.signUp({\n                email,\n                password\n            });\n            if (error) {\n                return {\n                    success: false,\n                    error: error.message\n                };\n            }\n            if (data.user) {\n                // Create user profile\n                const { error: profileError } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"users\").insert({\n                    id: data.user.id,\n                    email,\n                    name,\n                    preferences: {\n                        darkMode: true,\n                        ttsEnabled: true,\n                        notifications: true\n                    }\n                });\n                if (profileError) {\n                    console.error(\"Error creating user profile:\", profileError);\n                    return {\n                        success: false,\n                        error: \"Failed to create user profile\"\n                    };\n                }\n                this.dispatchUserChange();\n                return {\n                    success: true\n                };\n            }\n            return {\n                success: false,\n                error: \"Failed to create user\"\n            };\n        } catch (error) {\n            console.error(\"Sign up error:\", error);\n            return {\n                success: false,\n                error: (error === null || error === void 0 ? void 0 : error.message) || \"An unexpected error occurred\"\n            };\n        }\n    }\n    static async signIn(email, password) {\n        if (!this.isSupabaseConfigured()) {\n            return {\n                success: false,\n                error: \"Database not configured. Please set up Supabase credentials.\"\n            };\n        }\n        try {\n            const { data, error } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.auth.signInWithPassword({\n                email,\n                password\n            });\n            if (error) {\n                return {\n                    success: false,\n                    error: error.message\n                };\n            }\n            if (data.user) {\n                await this.getCurrentUser() // Load user data\n                ;\n                this.dispatchUserChange();\n                return {\n                    success: true\n                };\n            }\n            return {\n                success: false,\n                error: \"Failed to sign in\"\n            };\n        } catch (error) {\n            console.error(\"Sign in error:\", error);\n            return {\n                success: false,\n                error: (error === null || error === void 0 ? void 0 : error.message) || \"An unexpected error occurred\"\n            };\n        }\n    }\n    static async signOut() {\n        if (!this.isSupabaseConfigured()) {\n            return;\n        }\n        try {\n            await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.auth.signOut();\n            this.currentUser = null;\n            this.dispatchUserChange();\n        } catch (error) {\n            console.error(\"Sign out error:\", error);\n        }\n    }\n    static async updateUser(updates) {\n        if (!this.isSupabaseConfigured()) {\n            return false;\n        }\n        try {\n            const user = await this.getCurrentUser();\n            if (!user) return false;\n            const { error } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"users\").update({\n                name: updates.name,\n                preferences: updates.preferences\n            }).eq(\"id\", user.id);\n            if (error) {\n                console.error(\"Error updating user:\", error);\n                return false;\n            }\n            // Update local cache\n            if (this.currentUser) {\n                this.currentUser = {\n                    ...this.currentUser,\n                    ...updates\n                };\n            }\n            this.dispatchUserChange();\n            return true;\n        } catch (error) {\n            console.error(\"Update user error:\", error);\n            return false;\n        }\n    }\n    // Chat conversation methods\n    static async saveConversation(messages, title) {\n        if (!this.isSupabaseConfigured()) {\n            return null;\n        }\n        try {\n            const user = await this.getCurrentUser();\n            if (!user) return null;\n            const conversationTitle = title || this.generateConversationTitle(messages);\n            const { data, error } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"conversations\").insert({\n                user_id: user.id,\n                title: conversationTitle,\n                messages\n            }).select().single();\n            if (error) {\n                console.error(\"Error saving conversation:\", error);\n                return null;\n            }\n            return (data === null || data === void 0 ? void 0 : data.id) || null;\n        } catch (error) {\n            console.error(\"Save conversation error:\", error);\n            return null;\n        }\n    }\n    static async updateConversation(conversationId, messages) {\n        if (!this.isSupabaseConfigured()) {\n            return false;\n        }\n        try {\n            const { error } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"conversations\").update({\n                messages,\n                updated_at: new Date().toISOString()\n            }).eq(\"id\", conversationId);\n            if (error) {\n                console.error(\"Error updating conversation:\", error);\n                return false;\n            }\n            return true;\n        } catch (error) {\n            console.error(\"Update conversation error:\", error);\n            return false;\n        }\n    }\n    static async getConversations() {\n        if (!this.isSupabaseConfigured()) {\n            return [];\n        }\n        try {\n            const user = await this.getCurrentUser();\n            if (!user) return [];\n            const { data, error } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"conversations\").select(\"*\").eq(\"user_id\", user.id).order(\"updated_at\", {\n                ascending: false\n            });\n            if (error) {\n                console.error(\"Error getting conversations:\", error);\n                return [];\n            }\n            return (data || []).map((conv)=>({\n                    id: conv.id,\n                    userId: conv.user_id,\n                    title: conv.title,\n                    messages: Array.isArray(conv.messages) ? conv.messages : [],\n                    createdAt: conv.created_at,\n                    updatedAt: conv.updated_at\n                }));\n        } catch (error) {\n            console.error(\"Get conversations error:\", error);\n            return [];\n        }\n    }\n    static async deleteConversation(conversationId) {\n        if (!this.isSupabaseConfigured()) {\n            return false;\n        }\n        try {\n            const { error } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"conversations\").delete().eq(\"id\", conversationId);\n            if (error) {\n                console.error(\"Error deleting conversation:\", error);\n                return false;\n            }\n            return true;\n        } catch (error) {\n            console.error(\"Delete conversation error:\", error);\n            return false;\n        }\n    }\n    static generateConversationTitle(messages) {\n        const firstUserMessage = messages.find((m)=>m.role === \"user\");\n        if (firstUserMessage && firstUserMessage.content) {\n            const title = firstUserMessage.content.slice(0, 50);\n            return title.length < firstUserMessage.content.length ? \"\".concat(title, \"...\") : title;\n        }\n        return \"Conversation \".concat(new Date().toLocaleDateString());\n    }\n    static dispatchUserChange() {\n        if (true) {\n            window.dispatchEvent(new Event(\"userChanged\"));\n        }\n    }\n    // Initialize auth state listener\n    static initializeAuthListener() {\n        if (!this.isSupabaseConfigured()) {\n            return;\n        }\n        _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.auth.onAuthStateChange(async (event, session)=>{\n            if (event === \"SIGNED_IN\" && (session === null || session === void 0 ? void 0 : session.user)) {\n                await this.getCurrentUser();\n            } else if (event === \"SIGNED_OUT\") {\n                this.currentUser = null;\n            }\n            this.dispatchUserChange();\n        });\n    }\n}\nSupabaseUserService.currentUser = null;\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevSignature = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevSignature) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports signature on update so we can compare the boundary\n                // signatures. We avoid saving exports themselves since it causes memory leaks (https://github.com/vercel/next.js/pull/53797)\n                module.hot.dispose(function (data) {\n                    data.prevSignature =\n                        self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports);\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevSignature !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevSignature, self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports))) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevSignature !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uL2xpYi9zdXBhYmFzZS11c2VyLXNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBcUM7QUE4QjlCLE1BQU1DO0lBR1gsT0FBZUMsdUJBQWdDO1FBQzdDLE9BQU9GLCtDQUFRQSxLQUFLO0lBQ3RCO0lBRUEsYUFBYUcsaUJBQTJDO1FBQ3RELElBQUksQ0FBQyxJQUFJLENBQUNELG9CQUFvQixJQUFJO1lBQ2hDLE9BQU87UUFDVDtRQUVBLElBQUk7WUFDRixNQUFNLEVBQ0pFLE1BQU0sRUFBRUMsSUFBSSxFQUFFLEVBQ2RDLE9BQU9DLFNBQVMsRUFDakIsR0FBRyxNQUFNUCwrQ0FBUUEsQ0FBQ1EsSUFBSSxDQUFDQyxPQUFPO1lBRS9COzs7O09BSUMsR0FDRCxJQUFJRixhQUFhQSxVQUFVRyxPQUFPLEtBQUsseUJBQXlCO2dCQUM5REMsUUFBUUwsS0FBSyxDQUFDLGVBQWVDO1lBQy9CO1lBRUEsSUFBSSxDQUFDRixNQUFNLE9BQU87WUFFbEIsSUFBSSxDQUFDLElBQUksQ0FBQ08sV0FBVyxJQUFJLElBQUksQ0FBQ0EsV0FBVyxDQUFDQyxFQUFFLEtBQUtSLEtBQUtRLEVBQUUsRUFBRTtnQkFDeEQsTUFBTSxFQUFFVCxNQUFNVSxRQUFRLEVBQUVSLE9BQU9TLE9BQU8sRUFBRSxHQUFHLE1BQU1mLCtDQUFRQSxDQUFDZ0IsSUFBSSxDQUFDLFNBQVNDLE1BQU0sQ0FBQyxLQUFLQyxFQUFFLENBQUMsTUFBTWIsS0FBS1EsRUFBRSxFQUFFTSxNQUFNO2dCQUU1RyxJQUFJSixTQUFTO29CQUNYSixRQUFRTCxLQUFLLENBQUMsbUJBQW1CUztvQkFDakMsT0FBTztnQkFDVDtnQkFFQSxJQUFJRCxVQUFVO29CQUNaLElBQUksQ0FBQ0YsV0FBVyxHQUFHO3dCQUNqQkMsSUFBSUMsU0FBU0QsRUFBRTt3QkFDZk8sTUFBTU4sU0FBU00sSUFBSTt3QkFDbkJDLE9BQU9QLFNBQVNPLEtBQUs7d0JBQ3JCQyxXQUFXLElBQUlDLEtBQUtULFNB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Q0EsSUFBSSxDQUFDc0Isa0JBQWtCO1FBQ3pCO0lBQ0Y7QUFDRjtBQXBVYWpDLG9CQUNJVyxjQUErQiIsInNvdXJjZXMiOlsiL2hvbWUvcHJvamVjdC9saWIvc3VwYWJhc2UtdXNlci1zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSBcIi4vc3VwYWJhc2VcIlxuXG5leHBvcnQgaW50ZXJmYWNlIEp1bm9Vc2VyIHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgZW1haWw6IHN0cmluZ1xuICBjcmVhdGVkQXQ6IERhdGVcbiAgcHJlZmVyZW5jZXM6IHtcbiAgICBkYXJrTW9kZTogYm9vbGVhblxuICAgIHR0c0VuYWJsZWQ6IGJvb2xlYW5cbiAgICBub3RpZmljYXRpb25zOiBib29sZWFuXG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBDaGF0TWVzc2FnZSB7XG4gIGlkOiBzdHJpbmdcbiAgcm9sZTogXCJ1c2VyXCIgfCBcImFzc2lzdGFudFwiXG4gIGNvbnRlbnQ6IHN0cmluZ1xuICB0aW1lc3RhbXA6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbnZlcnNhdGlvbiB7XG4gIGlkOiBzdHJpbmdcbiAgdXNlcklkOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXVxuICBjcmVhdGVkQXQ6IHN0cmluZ1xuICB1cGRhdGVkQXQ6IHN0cmluZ1xufVxuXG5leHBvcnQgY2xhc3MgU3VwYWJhc2VVc2VyU2VydmljZSB7XG4gIHByaXZhdGUgc3RhdGljIGN1cnJlbnRVc2VyOiBKdW5vVXNlciB8IG51bGwgPSBudWxsXG5cbiAgcHJpdmF0ZSBzdGF0aWMgaXNTdXBhYmFzZUNvbmZpZ3VyZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHN1cGFiYXNlICE9PSBudWxsXG4gIH1cblxuICBzdGF0aWMgYXN5bmMgZ2V0Q3VycmVudFVzZXIoKTogUHJvbWlzZTxKdW5vVXNlciB8IG51bGw+IHtcbiAgICBpZiAoIXRoaXMuaXNTdXBhYmFzZUNvbmZpZ3VyZWQoKSkge1xuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3Qge1xuICAgICAgICBkYXRhOiB7IHVzZXIgfSxcbiAgICAgICAgZXJyb3I6IGF1dGhFcnJvcixcbiAgICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKVxuXG4gICAgICAvKipcbiAgICAgICAqIFN1cGFiYXNlIHJldHVybnMgYW4gYEF1dGggc2Vzc2lvbiBtaXNzaW5nIWAgZXJyb3JcbiAgICAgICAqIHdoZW4gdGhlIHVzZXIgaXMgbm90IHNpZ25lZC1pbi4gVGhpcyBpc27igJl0IGEgcmVhbFxuICAgICAgICogZmFpbHVyZeKAiuKAlOKAiml0IHNpbXBseSBtZWFucyB0aGVyZeKAmXMgbm8gYWN0aXZlIHNlc3Npb24uXG4gICAgICAgKi9cbiAgICAgIGlmIChhdXRoRXJyb3IgJiYgYXV0aEVycm9yLm1lc3NhZ2UgIT09IFwiQXV0aCBzZXNzaW9uIG1pc3NpbmchXCIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkF1dGggZXJyb3I6XCIsIGF1dGhFcnJvcilcbiAgICAgIH1cblxuICAgICAgaWYgKCF1c2VyKSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoIXRoaXMuY3VycmVudFVzZXIgfHwgdGhpcy5jdXJyZW50VXNlci5pZCAhPT0gdXNlci5pZCkge1xuICAgICAgICBjb25zdCB7IGRhdGE6IHVzZXJEYXRhLCBlcnJvcjogZGJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbShcInVzZXJzXCIpLnNlbGVjdChcIipcIikuZXEoXCJpZFwiLCB1c2VyLmlkKS5zaW5nbGUoKVxuXG4gICAgICAgIGlmIChkYkVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkRhdGFiYXNlIGVycm9yOlwiLCBkYkVycm9yKVxuICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIH1cblxuICAgICAgICBpZiAodXNlckRhdGEpIHtcbiAgICAgICAgICB0aGlzLmN1cnJlbnRVc2VyID0ge1xuICAgICAgICAgICAgaWQ6IHVzZXJEYXRhLmlkLFxuICAgICAgICAgICAgbmFtZTogdXNlckRhdGEubmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiB1c2VyRGF0YS5lbWFpbCxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUodXNlckRhdGEuY3JlYXRlZF9hdCksXG4gICAgICAgICAgICBwcmVmZXJlbmNlczogdXNlckRhdGEucHJlZmVyZW5jZXMgfHwge1xuICAgICAgICAgICAgICBkYXJrTW9kZTogdHJ1ZSxcbiAgICAgICAgICAgICAgdHRzRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgbm90aWZpY2F0aW9uczogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRVc2VyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBnZXR0aW5nIGN1cnJlbnQgdXNlcjpcIiwgZXJyb3IpXG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBzaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IGVycm9yPzogc3RyaW5nIH0+IHtcbiAgICBpZiAoIXRoaXMuaXNTdXBhYmFzZUNvbmZpZ3VyZWQoKSkge1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkRhdGFiYXNlIG5vdCBjb25maWd1cmVkLiBQbGVhc2Ugc2V0IHVwIFN1cGFiYXNlIGNyZWRlbnRpYWxzLlwiIH1cbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5zaWduVXAoe1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgcGFzc3dvcmQsXG4gICAgICB9KVxuXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGRhdGEudXNlcikge1xuICAgICAgICAvLyBDcmVhdGUgdXNlciBwcm9maWxlXG4gICAgICAgIGNvbnN0IHsgZXJyb3I6IHByb2ZpbGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbShcInVzZXJzXCIpLmluc2VydCh7XG4gICAgICAgICAgaWQ6IGRhdGEudXNlci5pZCxcbiAgICAgICAgICBlbWFpbCxcbiAgICAgICAgICBuYW1lLFxuICAgICAgICAgIHByZWZlcmVuY2VzOiB7XG4gICAgICAgICAgICBkYXJrTW9kZTogdHJ1ZSxcbiAgICAgICAgICAgIHR0c0VuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICBub3RpZmljYXRpb25zOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgaWYgKHByb2ZpbGVFcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjcmVhdGluZyB1c2VyIHByb2ZpbGU6XCIsIHByb2ZpbGVFcnJvcilcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGNyZWF0ZSB1c2VyIHByb2ZpbGVcIiB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmRpc3BhdGNoVXNlckNoYW5nZSgpXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGNyZWF0ZSB1c2VyXCIgfVxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIGVycm9yOlwiLCBlcnJvcilcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3I/Lm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkXCIgfVxuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBzaWduSW4oZW1haWw6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBlcnJvcj86IHN0cmluZyB9PiB7XG4gICAgaWYgKCF0aGlzLmlzU3VwYWJhc2VDb25maWd1cmVkKCkpIHtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJEYXRhYmFzZSBub3QgY29uZmlndXJlZC4gUGxlYXNlIHNldCB1cCBTdXBhYmFzZSBjcmVkZW50aWFscy5cIiB9XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbkluV2l0aFBhc3N3b3JkKHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHBhc3N3b3JkLFxuICAgICAgfSlcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9XG4gICAgICB9XG5cbiAgICAgIGlmIChkYXRhLnVzZXIpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcigpIC8vIExvYWQgdXNlciBkYXRhXG4gICAgICAgIHRoaXMuZGlzcGF0Y2hVc2VyQ2hhbmdlKClcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gc2lnbiBpblwiIH1cbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiU2lnbiBpbiBlcnJvcjpcIiwgZXJyb3IpXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yPy5tZXNzYWdlIHx8IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZFwiIH1cbiAgICB9XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgc2lnbk91dCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuaXNTdXBhYmFzZUNvbmZpZ3VyZWQoKSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbk91dCgpXG4gICAgICB0aGlzLmN1cnJlbnRVc2VyID0gbnVsbFxuICAgICAgdGhpcy5kaXNwYXRjaFVzZXJDaGFuZ2UoKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiU2lnbiBvdXQgZXJyb3I6XCIsIGVycm9yKVxuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBhc3luYyB1cGRhdGVVc2VyKHVwZGF0ZXM6IFBhcnRpYWw8SnVub1VzZXI+KTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgaWYgKCF0aGlzLmlzU3VwYWJhc2VDb25maWd1cmVkKCkpIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcigpXG4gICAgICBpZiAoIXVzZXIpIHJldHVybiBmYWxzZVxuXG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbShcInVzZXJzXCIpXG4gICAgICAgIC51cGRhdGUoe1xuICAgICAgICAgIG5hbWU6IHVwZGF0ZXMubmFtZSxcbiAgICAgICAgICBwcmVmZXJlbmNlczogdXBkYXRlcy5wcmVmZXJlbmNlcyxcbiAgICAgICAgfSlcbiAgICAgICAgLmVxKFwiaWRcIiwgdXNlci5pZClcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyB1c2VyOlwiLCBlcnJvcilcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSBsb2NhbCBjYWNoZVxuICAgICAgaWYgKHRoaXMuY3VycmVudFVzZXIpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50VXNlciA9IHsgLi4udGhpcy5jdXJyZW50VXNlciwgLi4udXBkYXRlcyB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMuZGlzcGF0Y2hVc2VyQ2hhbmdlKClcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgdXNlciBlcnJvcjpcIiwgZXJyb3IpXG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG4gIH1cblxuICAvLyBDaGF0IGNvbnZlcnNhdGlvbiBtZXRob2RzXG4gIHN0YXRpYyBhc3luYyBzYXZlQ29udmVyc2F0aW9uKG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdLCB0aXRsZT86IHN0cmluZyk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICAgIGlmICghdGhpcy5pc1N1cGFiYXNlQ29uZmlndXJlZCgpKSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcigpXG4gICAgICBpZiAoIXVzZXIpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IGNvbnZlcnNhdGlvblRpdGxlID0gdGl0bGUgfHwgdGhpcy5nZW5lcmF0ZUNvbnZlcnNhdGlvblRpdGxlKG1lc3NhZ2VzKVxuXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbShcImNvbnZlcnNhdGlvbnNcIilcbiAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgdXNlcl9pZDogdXNlci5pZCxcbiAgICAgICAgICB0aXRsZTogY29udmVyc2F0aW9uVGl0bGUsXG4gICAgICAgICAgbWVzc2FnZXMsXG4gICAgICAgIH0pXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuc2luZ2xlKClcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzYXZpbmcgY29udmVyc2F0aW9uOlwiLCBlcnJvcilcbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGRhdGE/LmlkIHx8IG51bGxcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIlNhdmUgY29udmVyc2F0aW9uIGVycm9yOlwiLCBlcnJvcilcbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuICB9XG5cbiAgc3RhdGljIGFzeW5jIHVwZGF0ZUNvbnZlcnNhdGlvbihjb252ZXJzYXRpb25JZDogc3RyaW5nLCBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmICghdGhpcy5pc1N1cGFiYXNlQ29uZmlndXJlZCgpKSB7XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oXCJjb252ZXJzYXRpb25zXCIpXG4gICAgICAgIC51cGRhdGUoe1xuICAgICAgICAgIG1lc3NhZ2VzLFxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgfSlcbiAgICAgICAgLmVxKFwiaWRcIiwgY29udmVyc2F0aW9uSWQpXG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgY29udmVyc2F0aW9uOlwiLCBlcnJvcilcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0cnVlXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgY29udmVyc2F0aW9uIGVycm9yOlwiLCBlcnJvcilcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBnZXRDb252ZXJzYXRpb25zKCk6IFByb21pc2U8Q29udmVyc2F0aW9uW10+IHtcbiAgICBpZiAoIXRoaXMuaXNTdXBhYmFzZUNvbmZpZ3VyZWQoKSkge1xuICAgICAgcmV0dXJuIFtdXG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKClcbiAgICAgIGlmICghdXNlcikgcmV0dXJuIFtdXG5cbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKFwiY29udmVyc2F0aW9uc1wiKVxuICAgICAgICAuc2VsZWN0KFwiKlwiKVxuICAgICAgICAuZXEoXCJ1c2VyX2lkXCIsIHVzZXIuaWQpXG4gICAgICAgIC5vcmRlcihcInVwZGF0ZWRfYXRcIiwgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZ2V0dGluZyBjb252ZXJzYXRpb25zOlwiLCBlcnJvcilcbiAgICAgICAgcmV0dXJuIFtdXG4gICAgICB9XG5cbiAgICAgIHJldHVybiAoZGF0YSB8fCBbXSkubWFwKChjb252KSA9PiAoe1xuICAgICAgICBpZDogY29udi5pZCxcbiAgICAgICAgdXNlcklkOiBjb252LnVzZXJfaWQsXG4gICAgICAgIHRpdGxlOiBjb252LnRpdGxlLFxuICAgICAgICBtZXNzYWdlczogQXJyYXkuaXNBcnJheShjb252Lm1lc3NhZ2VzKSA/IGNvbnYubWVzc2FnZXMgOiBbXSxcbiAgICAgICAgY3JlYXRlZEF0OiBjb252LmNyZWF0ZWRfYXQsXG4gICAgICAgIHVwZGF0ZWRBdDogY29udi51cGRhdGVkX2F0LFxuICAgICAgfSkpXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJHZXQgY29udmVyc2F0aW9ucyBlcnJvcjpcIiwgZXJyb3IpXG4gICAgICByZXR1cm4gW11cbiAgICB9XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgZGVsZXRlQ29udmVyc2F0aW9uKGNvbnZlcnNhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBpZiAoIXRoaXMuaXNTdXBhYmFzZUNvbmZpZ3VyZWQoKSkge1xuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oXCJjb252ZXJzYXRpb25zXCIpLmRlbGV0ZSgpLmVxKFwiaWRcIiwgY29udmVyc2F0aW9uSWQpXG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZGVsZXRpbmcgY29udmVyc2F0aW9uOlwiLCBlcnJvcilcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0cnVlXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJEZWxldGUgY29udmVyc2F0aW9uIGVycm9yOlwiLCBlcnJvcilcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIGdlbmVyYXRlQ29udmVyc2F0aW9uVGl0bGUobWVzc2FnZXM6IENoYXRNZXNzYWdlW10pOiBzdHJpbmcge1xuICAgIGNvbnN0IGZpcnN0VXNlck1lc3NhZ2UgPSBtZXNzYWdlcy5maW5kKChtKSA9PiBtLnJvbGUgPT09IFwidXNlclwiKVxuICAgIGlmIChmaXJzdFVzZXJNZXNzYWdlICYmIGZpcnN0VXNlck1lc3NhZ2UuY29udGVudCkge1xuICAgICAgY29uc3QgdGl0bGUgPSBmaXJzdFVzZXJNZXNzYWdlLmNvbnRlbnQuc2xpY2UoMCwgNTApXG4gICAgICByZXR1cm4gdGl0bGUubGVuZ3RoIDwgZmlyc3RVc2VyTWVzc2FnZS5jb250ZW50Lmxlbmd0aCA/IGAke3RpdGxlfS4uLmAgOiB0aXRsZVxuICAgIH1cbiAgICByZXR1cm4gYENvbnZlcnNhdGlvbiAke25ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCl9YFxuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgZGlzcGF0Y2hVc2VyQ2hhbmdlKCk6IHZvaWQge1xuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoXCJ1c2VyQ2hhbmdlZFwiKSlcbiAgICB9XG4gIH1cblxuICAvLyBJbml0aWFsaXplIGF1dGggc3RhdGUgbGlzdGVuZXJcbiAgc3RhdGljIGluaXRpYWxpemVBdXRoTGlzdGVuZXIoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmlzU3VwYWJhc2VDb25maWd1cmVkKCkpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHN1cGFiYXNlLmF1dGgub25BdXRoU3RhdGVDaGFuZ2UoYXN5bmMgKGV2ZW50LCBzZXNzaW9uKSA9PiB7XG4gICAgICBpZiAoZXZlbnQgPT09IFwiU0lHTkVEX0lOXCIgJiYgc2Vzc2lvbj8udXNlcikge1xuICAgICAgICBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKClcbiAgICAgIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiU0lHTkVEX09VVFwiKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFVzZXIgPSBudWxsXG4gICAgICB9XG4gICAgICB0aGlzLmRpc3BhdGNoVXNlckNoYW5nZSgpXG4gICAgfSlcbiAgfVxufVxuIl0sIm5hbWVzIjpbInN1cGFiYXNlIiwiU3VwYWJhc2VVc2VyU2VydmljZSIsImlzU3VwYWJhc2VDb25maWd1cmVkIiwiZ2V0Q3VycmVudFVzZXIiLCJkYXRhIiwidXNlciIsImVycm9yIiwiYXV0aEVycm9yIiwiYXV0aCIsImdldFVzZXIiLCJtZXNzYWdlIiwiY29uc29sZSIsImN1cnJlbnRVc2VyIiwiaWQiLCJ1c2VyRGF0YSIsImRiRXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJzaW5nbGUiLCJuYW1lIiwiZW1haWwiLCJjcmVhdGVkQXQiLCJEYXRlIiwiY3JlYXRlZF9hdCIsInByZWZlcmVuY2VzIiwiZGFya01vZGUiLCJ0dHNFbmFibGVkIiwibm90aWZpY2F0aW9ucyIsInNpZ25VcCIsInBhc3N3b3JkIiwic3VjY2VzcyIsInByb2ZpbGVFcnJvciIsImluc2VydCIsImRpc3BhdGNoVXNlckNoYW5nZSIsInNpZ25JbiIsInNpZ25JbldpdGhQYXNzd29yZCIsInNpZ25PdXQiLCJ1cGRhdGVVc2VyIiwidXBkYXRlcyIsInVwZGF0ZSIsInNhdmVDb252ZXJzYXRpb24iLCJtZXNzYWdlcyIsInRpdGxlIiwiY29udmVyc2F0aW9uVGl0bGUiLCJnZW5lcmF0ZUNvbnZlcnNhdGlvblRpdGxlIiwidXNlcl9pZCIsInVwZGF0ZUNvbnZlcnNhdGlvbiIsImNvbnZlcnNhdGlvbklkIiwidXBkYXRlZF9hdCIsInRvSVNPU3RyaW5nIiwiZ2V0Q29udmVyc2F0aW9ucyIsIm9yZGVyIiwiYXNjZW5kaW5nIiwibWFwIiwiY29udiIsInVzZXJJZCIsIkFycmF5IiwiaXNBcnJheSIsInVwZGF0ZWRBdCIsImRlbGV0ZUNvbnZlcnNhdGlvbiIsImRlbGV0ZSIsImZpcnN0VXNlck1lc3NhZ2UiLCJmaW5kIiwibSIsInJvbGUiLCJjb250ZW50Iiwic2xpY2UiLCJsZW5ndGgiLCJ0b0xvY2FsZURhdGVTdHJpbmciLCJ3aW5kb3ciLCJkaXNwYXRjaEV2ZW50IiwiRXZlbnQiLCJpbml0aWFsaXplQXV0aExpc3RlbmVyIiwib25BdXRoU3RhdGVDaGFuZ2UiLCJldmVudCIsInNlc3Npb24iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(app-pages-browser)/./lib/supabase-user-service.ts\n"));

/***/ })

});